<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Video Test UI</title>
    <script src="resources/pep.min.js"></script>
    <script src="resources/object-frames.js"></script>
    <style>
        body {
            /*width: 548px;*/
            /*height: 340px;*/
            /*background-color: #4E4E4F;*/
            overflow: visible;
        }
        #container {
            width: 538px;
            height: 290px;
            border: 5px solid cyan;
            border-radius: 10px;
            padding: 10px;
            position: relative;
            display: table-cell;
            vertical-align: middle;
            text-align: center;
        }
        
        #recordedVideo {
            position: absolute;
            top: 0;
            left: 0;
        }

        .hidden {
            display: none;
        }

        .visible {
            display: inline-block;
        }

        .spinner {
            width: 70px;
            text-align: center;
        }

        .spinner > div {
            width: 18px;
            height: 18px;
            background-color: cyan;

            border-radius: 100%;
            display: inline-block;
            -webkit-animation: sk-bouncedelay 1.4s infinite ease-in-out both;
            animation: sk-bouncedelay 1.4s infinite ease-in-out both;
        }

        .spinner .bounce1 {
            -webkit-animation-delay: -0.32s;
            animation-delay: -0.32s;
        }

        .spinner .bounce2 {
            -webkit-animation-delay: -0.16s;
            animation-delay: -0.16s;
        }

        @-webkit-keyframes sk-bouncedelay {
            0%, 80%, 100% { -webkit-transform: scale(0) }
            40% { -webkit-transform: scale(1.0) }
        }

        @keyframes sk-bouncedelay {
            0%, 80%, 100% {
                -webkit-transform: scale(0);
                transform: scale(0);
            } 40% {
                  -webkit-transform: scale(1.0);
                  transform: scale(1.0);
              }
        }
        
        #recordButtonOutline {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 5px solid white;
        }
        
        #recordButton {
            width: 76px;
            height: 76px;
            border-radius: 50%;
            background-color: rgb(255,0,124);
            margin-top: 13px;
            -webkit-transform: scale(1);
        }
        
        @keyframes recordButtonStart {
            0% {
                -webkit-transform: scale(1);
                border-radius: 50%;
            }
            25% {
                -webkit-transform: scale(1.1);
                border-radius: 50%;
            }
            100% {
                -webkit-transform: scale(0.6);
                border-radius: 10%;
            }
        }
        
        .currentlyRecording {
            -webkit-transform: scale(0.6);
            border-radius: 10%;
            -webkit-animation: recordButtonStart 0.25s ease-out both;
            animation: recordButtonStart 0.25s ease-out both;
        }
        
        .recordingIndicator {
            position: absolute;
            left: 20px;
            top: 20px;
            font-family: "Futura", Helvetica Neue, Helvetica, Arial, sans-serif;
            color: white;
            font-size: 22px;
        }
        
        .recordingDot {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background-color: rgb(255,0,124);
        }
        
        .recordingText {
            position: absolute;
            top: -4px;
            left: 36px;
            width: 300px;
            text-align: left;
        }

        @keyframes recordButtonHide {
            0% {
                -webkit-transform: scale(1);
            }
            25% {
                -webkit-transform: scale(1.1);
            }
            100% {
                -webkit-transform: scale(0);
            }
        }

        .hiddenRecordingButton {
            -webkit-transform: scale(0);
            -webkit-animation: recordButtonHide 0.25s ease-out both;
            animation: recordButtonHide 0.25s ease-out both;
        }
        
    </style>
</head>
<body>
    
    <div id="container" touch-action="none">
        <div>
            <video id="recordedVideo" class="hidden" width="558" height="310" playsinline controls webkit-playsinline loop></video>
            
            <div id="recordButtonOutline" class="visible">
                <div id="recordButton" class="visible">

                </div>
            </div>
            
            <div class="recordingIndicator hidden">
                <div class="recordingDot"></div>
                <div class="recordingText">REC</div>
            </div>

            <div class="spinner hidden">
                <div class="bounce1"></div>
                <div class="bounce2"></div>
                <div class="bounce3"></div>
            </div>
            
        </div>
    </div>

    <script>
        
        // TODO: programmatically set width and height based on phone screen size
        var isRecording = false;
        var secondsRecorded = 0;
        var recordingInterval = null;
        
        var recordButton = document.getElementById('recordButton');
        
        var realityInterface = new RealityInterface();

        recordButton.addEventListener('pointerup', function(e) {
            isRecording = !isRecording;

            if (isRecording) {
                startRecording();
            } else {
                stopRecording();
            }

        });
        
        function startRecording() {
            recordButton.classList.add('currentlyRecording');
            
            setTimeout(function() {

                realityInterface.setStickyFullScreenOn();
                realityInterface.startVideoRecording();

                document.querySelector('.recordingIndicator').classList.remove('hidden');
                document.querySelector('.recordingIndicator').classList.add('visible');
                
                secondsRecorded = 0;
                document.querySelector('.recordingText').innerHTML = 'REC   ' + formatSecondsAsTime(secondsRecorded);
                
                recordingInterval = setInterval(function() {
                    secondsRecorded += 1;
                    document.querySelector('.recordingText').innerHTML = 'REC   ' + formatSecondsAsTime(secondsRecorded);
                }, 1000);
                
            }, 250);

        }
        
        function stopRecording() {
            recordButton.classList.remove('currentlyRecording');
            
            setTimeout(function() {
                
                realityInterface.setFullScreenOff();
                realityInterface.stopVideoRecording(function(videoFilePath) {
                    console.log('video was saved at path: ' + videoFilePath);
                });

                // hide indicator and timer in corner
                document.querySelector('.recordingIndicator').classList.remove('visible');
                document.querySelector('.recordingIndicator').classList.add('hidden');
                
                document.querySelector('#recordButtonOutline').classList.add('hiddenRecordingButton');
                
                setTimeout(function() {
                    // hide stop button
                    document.querySelector('#recordButtonOutline').classList.remove('visible');
                    document.querySelector('#recordButtonOutline').classList.add('hidden');

                    // show loading indicator
                    document.querySelector('.spinner').classList.remove('hidden');
                    document.querySelector('.spinner').classList.add('visible');
                }, 500);
                
            }, 0);
        }
        
        function formatSecondsAsTime(seconds) {
            var hours = Math.floor(seconds / 3600);
            seconds -= hours * 3600;
            var minutes = Math.floor(seconds / 60);
            seconds -= minutes * 60;
            return hours.pad() + ':' + minutes.pad() + ':' + seconds.pad();
        }

        Number.prototype.pad = function(size) {
            var s = String(this);
            while (s.length < (size || 2)) {s = "0" + s;}
            return s;
        };
        
    </script>

</body>
</html>
